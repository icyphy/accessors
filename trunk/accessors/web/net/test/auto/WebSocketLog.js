exports.setup = function () {
    //  This composite accessor was created by Cape Code.
    //  To run the code, run: 
    //  (cd $PTII/org/terraswarm/accessor/accessors/web/net/test/auto; node ../../../node_modules/@accessors-hosts/node/nodeHostInvoke.js net/test/auto/WebSocketLog)
    //  To regenerate this composite accessor, run:
    //  $PTII/bin/ptinvoke ptolemy.cg.kernel.generic.accessor.AccessorCodeGenerator -language accessor $PTII/./ptolemy/actor/lib/jjs/modules/webSocket/demo/WebSocketLog/WebSocketLog.xml
    //  to edit the model, run:
    //  $PTII/bin/capecode $PTII/./ptolemy/actor/lib/jjs/modules/webSocket/demo/WebSocketLog/WebSocketLog.xml

    // Ports: WebSocketLog: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/TypedCompositeActor.java

    // Start: TestSpontaneous: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: TestSpontaneous: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var TestSpontaneous = this.instantiateFromCode('TestSpontaneous', unescape('//%20Test%20accessor%20that%20spontaneously%20produces%20outputs%20once%20per%20time%20interval.%0A//%0A//%20Copyright%20%28c%29%202015-2016%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A//%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A//%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A//%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A//%0A%0A/**%20Test%20accessor%20that%20spontaneously%20produces%20outputs%20once%20per%20time%20interval.%0A%20*%20%20This%20implementation%20produces%20a%20counting%20sequence.%0A%20*%0A%20*%20%20@accessor%20test/TestSpontaneous%0A%20*%20%20@parameter%20interval%20The%20interval%20between%20outputs%20in%20milliseconds.%0A%20*%20%20@output%20output%20Output%20for%20the%20counting%20sequence%2C%20of%20type%20number.%0A%20*%20%20@author%20Edward%20A.%20Lee%0A%20*%20%20@version%20%24%24Id%3A%20TestSpontaneous.js%201117%202016-11-23%2000%3A59%3A47Z%20cxh%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint.%20%20Note%20that%20there%20should%20be%20no%0A//%20space%20between%20the%20/%20and%20the%20*%20and%20global.%0A/*globals%20clearInterval%2C%20exports%2C%20require%2C%20setInterval%20*/%0A/*jshint%20globalstrict%3A%20true*/%0A%22use%20strict%22%3B%0A%0Aexports.setup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.parameter%28%27interval%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27number%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%201000%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.output%28%27output%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27number%27%0A%20%20%20%20%7D%29%3B%0A%7D%3B%0A%0A//%20These%20variables%20will%20not%20be%20visible%20to%20subclasses.%0Avar%20handle%20%3D%20null%3B%0Avar%20count%20%3D%200%3B%0A%0Aexports.initialize%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20count%20%3D%200%3B%0A%20%20%20%20//%20Need%20to%20record%20%27this%27%20for%20use%20in%20the%20callback.%0A%20%20%20%20var%20thiz%20%3D%20this%3B%0A%20%20%20%20handle%20%3D%20setInterval%28function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20thiz.send%28%27output%27%2C%20count%29%3B%0A%20%20%20%20%20%20%20%20count%20+%3D%201%3B%0A%20%20%20%20%7D%2C%20this.getParameter%28%27interval%27%29%29%3B%0A%7D%3B%0A%0Aexports.wrapup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20if%20%28handle%29%20%7B%0A%20%20%20%20%20%20%20%20clearInterval%28handle%29%3B%0A%20%20%20%20%20%20%20%20handle%20%3D%20null%3B%0A%20%20%20%20%7D%0A%7D%3B%0A'));
    TestSpontaneous.setParameter('interval', 2500.0);

    // Start: WebSocketServer: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: WebSocketServer: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var WebSocketServer = this.instantiateFromCode('WebSocketServer', unescape('//%20Copyright%20%28c%29%202016-2017%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A//%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A//%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A//%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A//%0A%0A/**%20This%20accessor%20starts%20a%20server%20that%20listens%20for%20web%20socket%0A%20*%20%20connection%20requests%20on%20the%20specified%20hostInterface%20and%20port.%20%20The%0A%20*%20%20hostInterface%20is%20needed%20only%20if%20the%20host%20machine%20has%20more%20than%20one%0A%20*%20%20network%20interface%20%28e.g.%20Ethernet%20and%20WiFi%29%20and%20%27localhost%27%20does%0A%20*%20%20not%20resolve%20to%20the%20desired%20interface.%0A%20*%0A%20*%20%20The%20output%20%60connection%60%20reports%20the%20when%20a%0A%20*%20%20connection%20is%20opened%20or%20closed.%0A%20*%0A%20*%20%20When%20a%20message%20arrives%20on%20a%20connection%2C%20a%20%60received%60%0A%20*%20%20output%20is%20produced%20with%20that%20message.%20Note%20that%20the%20message%20may%20arrive%20in%0A%20*%20%20multiple%20frames%2C%20but%20it%20will%20be%20produced%20as%20a%20single%20message.%0A%20*%0A%20*%20%20When%20an%20input%20arrives%20on%20%60toSend%60%2C%20then%20a%20message%20is%0A%20*%20%20sent%20to%20one%20or%20all%20of%20the%20open%20socket%20connections.%0A%20*%0A%20*%20%20When%20%60wrapup%28%29%60%20is%20invoked%2C%20this%20accessor%20closes%20the%0A%20*%20%20server%20and%20all%20connections.%0A%20*%0A%20*%20%20The%20default%20type%20for%20both%20sending%20and%20receiving%0A%20*%20%20is%20%27application/json%27%2C%20which%20allows%20sending%20and%20receiving%20anything%20that%20has%0A%20*%20%20a%20string%20representation%20in%20JSON.%20The%20types%20supported%20by%20this%20implementation%0A%20*%20%20include%20at%20least%3A%0A%20*%20%20*%20__application/json__%3A%20The%20this.send%28%29%20function%20uses%20JSON.stringify%28%29%20and%20sends%20the%0A%20*%20%20%20%20result%20with%20a%20UTF-8%20encoding.%20An%20incoming%20byte%20stream%20will%20be%20parsed%20as%20JSON%2C%0A%20*%20%20%20%20and%20if%20the%20parsing%20fails%2C%20will%20be%20provided%20as%20a%20string%20interpretation%20of%20the%20byte%0A%20*%20%20%20%20stream.%0A%20*%20%20*%20__text/%5C*__%3A%20Any%20text%20type%20is%20sent%20as%20a%20string%20encoded%20in%20UTF-8.%0A%20*%20%20*%20__image/x__%3A%20Where%20__x__%20is%20one%20of%20__json__%2C%20__png__%2C%20__gif__%2C%0A%20*%20%20%20%20and%20more.%0A%20*%20%20%20%20In%20this%20case%2C%20the%20data%20passed%20to%20this.send%28%29%20is%20assumed%20to%20be%20an%20image%2C%20as%20encoded%0A%20*%20%20%20%20on%20the%20host%2C%20and%20the%20image%20will%20be%20encoded%20as%20a%20byte%20stream%20in%20the%20specified%0A%20*%20%20%20%20format%20before%20sending.%20%20A%20received%20byte%20stream%20will%20be%20decoded%20as%20an%20image%2C%0A%20*%20%20%20%20if%20possible.%0A%20*%0A%20*%20%20This%20accessor%20requires%20the%20module%20webSocket.%0A%20*%0A%20*%20%20@accessor%20net/WebSocketServer%0A%20*%20%20@parameter%20%7Bstring%7D%20hostInterface%20The%20IP%20address%20or%20domain%20name%20of%20the%0A%20*%20%20%20%20network%20interface%20to%20listen%20to.%0A%20*%20%20@parameter%20%7Bint%7D%20port%20The%20port%20to%20listen%20to%20for%20connections.%0A%20*%20%20@parameter%20%7Bstring%7D%20pfxKeyCertPassword%20If%20sslTls%20is%20set%20to%20true%2C%20then%20this%20option%20needs%0A%20*%20%20%20to%20specify%20the%20password%20for%20the%20pfx%20key-cert%20file%20specified%20by%20pfxKeyCertPath.%0A%20*%20%20@parameter%20%7Bstring%7D%20pfxKeyCertPath%20If%20sslTls%20is%20set%20to%20true%2C%20then%20this%20option%20needs%20to%0A%20*%20%20%20specify%20the%20fully%20qualified%20filename%20for%20the%20file%20that%20stores%20the%20private%20key%20and%20certificate%0A%20*%20%20%20that%20this%20server%20will%20use%20to%20identify%20itself.%20This%20path%20can%20be%20any%20of%20those%20understood%20by%20the%0A%20*%20%20%20Ptolemy%20host%2C%20e.g.%20paths%20beginning%20with%20%24CLASSPATH/.%0A%20*%20%20@parameter%20%7Bstring%7D%20receiveType%20The%20MIME%20type%20for%20incoming%20messages%2C%0A%20*%20%20%20%20which%20defaults%20to%20%27application/json%27.%0A%20*%20%20@parameter%20%7Bstring%7D%20sendType%20The%20MIME%20type%20for%20outgoing%20messages%2C%0A%20*%20%20%20%20which%20defaults%20to%20%27application/json%27.%0A%20*%20%20@parameter%20%7Bboolean%7D%20sslTls%20Whether%20SSL/TLS%20is%20enabled.%20This%20defaults%20to%20false.%0A%20*%20%20@input%20toSend%20The%20data%20to%20be%20sent%20to%20open%20sockets.%0A%20*%20%20%20%20If%20this%20is%20an%20object%20with%20%27socketID%27%20field%20and%20a%20%27message%27%20field%2C%0A%20*%20%20%20%20then%20send%20the%20value%20of%20the%20message%20field%20to%20the%20socket%20identified%0A%20*%20%20%20%20by%20the%20socketID%20field.%20If%20the%20input%20has%20any%20other%20form%2C%20then%20the%0A%20*%20%20%20%20message%20is%20broadcast%20to%20all%20open%20socket%20connections.%0A%20*%20%20@output%20%7Bint%7D%20listening%20When%20the%20server%20is%20listening%20for%20connections%2C%20this%20output%0A%20*%20%20%20%20will%20produce%20the%20port%20number%20that%20the%20server%20is%20listening%20on%0A%20*%20%20@output%20connection%20An%20output%20produced%20when%20a%20connection%20opens%20or%20closes.%0A%20*%20%20%20%20The%20output%20is%20an%20object%20with%20two%20fields%2C%20a%20%27socketID%27%2C%0A%20*%20%20%20%20which%20is%20a%20unique%20ID%20for%20this%20client%20connection%2C%20and%20a%20%27status%27%20field%2C%0A%20*%20%20%20%20which%20is%20the%20string%20%27open%27%20or%20%27closed%27.%0A%20*%20%20@output%20received%20A%20message%20received%20a%20client%20in%20the%20form%20of%20an%20object%20with%20two%20fields%2C%20a%20%27socketID%27%2C%20which%20is%20a%20unique%20ID%20for%20this%20client%20connection%2C%20and%20a%20%27message%27%20field%2C%20which%20is%20the%20message%20received%20from%20the%20client.%0A%20*%20%20@author%20Hokeun%20Kim%2C%20Edward%20Lee%0A%20*%20%20@version%20%24%24Id%3A%20WebSocketServer.js%201922%202017-07-04%2018%3A31%3A54Z%20eal%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint%20and%20jshint.%20%20Note%20that%20there%20should%0A//%20be%20no%20space%20between%20the%20/%20and%20the%20*%20and%20global.%20See%0A//%20https%3A//chess.eecs.berkeley.edu/ptexternal/wiki/Main/JSHint%20*/%0A/*globals%20console%2C%20error%2C%20exports%2C%20require%20*/%0A/*jshint%20globalstrict%3A%20true*/%0A%27use%20strict%27%3B%0A/*jslint%20plusplus%3A%20true%20*/%0A%0Avar%20WebSocket%20%3D%20require%28%27@accessors-modules/web-socket-server%27%29%3B%0Avar%20server%20%3D%20null%3B%0Avar%20running%20%3D%20false%3B%0Avar%20debug%20%3D%20false%3B%0A%0A/**%20Sets%20up%20the%20accessor%20by%20defining%20inputs%20and%20outputs.%20*/%0Aexports.setup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.parameter%28%27hostInterface%27%2C%20%7B%0A%20%20%20%20%20%20%20%20value%3A%20%22localhost%22%2C%0A%20%20%20%20%20%20%20%20type%3A%20%22string%22%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27port%27%2C%20%7B%0A%20%20%20%20%20%20%20%20value%3A%208080%2C%0A%20%20%20%20%20%20%20%20type%3A%20%22int%22%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27pfxKeyCertPassword%27%2C%20%7B%0A%20%20%20%20%20%20%20%20value%3A%20%27%27%2C%0A%20%20%20%20%20%20%20%20type%3A%20%27string%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27pfxKeyCertPath%27%2C%20%7B%0A%20%20%20%20%20%20%20%20value%3A%20%27%27%2C%0A%20%20%20%20%20%20%20%20type%3A%20%27string%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27receiveType%27%2C%20%7B%0A%20%20%20%20%20%20%20%20type%3A%20%27string%27%2C%0A%20%20%20%20%20%20%20%20value%3A%20%27application/json%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27sendType%27%2C%20%7B%0A%20%20%20%20%20%20%20%20type%3A%20%27string%27%2C%0A%20%20%20%20%20%20%20%20value%3A%20%27application/json%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27sslTls%27%2C%20%7B%0A%20%20%20%20%20%20%20%20type%3A%20%27boolean%27%2C%0A%20%20%20%20%20%20%20%20value%3A%20false%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.input%28%27toSend%27%29%3B%0A%20%20%20%20this.output%28%27received%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27spontaneous%27%3A%20true%20%20%20%20%20%20%20%20%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.output%28%27listening%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27int%27%2C%0A%20%20%20%20%20%20%20%20%27spontaneous%27%3A%20true%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.output%28%27connection%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27spontaneous%27%3A%20true%0A%20%20%20%20%7D%29%3B%0A%0A%20%20%20%20//%20Attempt%20to%20add%20a%20list%20of%20options%20for%20types%2C%20but%20do%20not%20error%20out%0A%20%20%20%20//%20if%20the%20socket%20module%20is%20not%20supported%20by%20the%20host.%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20this.parameter%28%27receiveType%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20options%3A%20WebSocket.supportedReceiveTypes%28%29%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20this.parameter%28%27sendType%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20options%3A%20WebSocket.supportedSendTypes%28%29%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%20catch%20%28err%29%20%7B%0A%20%20%20%20%20%20%20%20error%28err%29%3B%0A%20%20%20%20%7D%0A%7D%3B%0A%0A//var%20sockets%20%3D%20%5B%5D%3B%0A%0A/**%20Starts%20the%20web%20socket%20and%20attaches%20functions%20to%20inputs%20and%20outputs.%0A%20*%20Adds%20an%20input%20handler%20on%20toSend%20that%20sends%20the%20input%20received%20to%20the%20right%20socket.%20*/%0Aexports.initialize%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20var%20self%20%3D%20this%3B%0A%20%20%20%20self.sockets%20%3D%20%5B%5D%3B%0A%0A%20%20%20%20if%20%28%21server%29%20%7B%0A%20%20%20%20%20%20%20%20server%20%3D%20new%20WebSocket.Server%28%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%27port%27%3A%20this.getParameter%28%27port%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27hostInterface%27%3A%20this.getParameter%28%27hostInterface%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27pfxKeyCertPassword%27%3A%20this.getParameter%28%27pfxKeyCertPassword%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27pfxKeyCertPath%27%3A%20this.getParameter%28%27pfxKeyCertPath%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27receiveType%27%3A%20this.getParameter%28%27receiveType%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27sendType%27%3A%20this.getParameter%28%27sendType%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27sslTls%27%3A%20this.getParameter%28%27sslTls%27%29%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20//%20Using%20%27this.exports%27%20rather%20than%20just%20%27exports%27%20in%20the%20following%20allows%0A%20%20%20%20%20%20%20%20//%20these%20functions%20to%20be%20overridden%20in%20derived%20accessors.%0A%20%20%20%20%20%20%20%20server.on%28%27listening%27%2C%20this.exports.onListening.bind%28this%29%29%3B%0A%20%20%20%20%20%20%20%20server.on%28%27connection%27%2C%20this.exports.onConnection.bind%28this%29%29%3B%0A%20%20%20%20%20%20%20%20server.on%28%27error%27%2C%20function%20%28message%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.error%28message%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20server.start%28%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20running%20%3D%20true%3B%0A%0A%20%20%20%20this.addInputHandler%28%27toSend%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20var%20data%20%3D%20self.get%28%27toSend%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20id%3B%0A%20%20%20%20%20%20%20%20//%20Careful%3A%20Don%27t%20do%20if%20%28data%29%20because%20if%20data%20%3D%3D%3D%200%2C%20then%20data%20is%20false.%0A%20%20%20%20%20%20%20%20if%20%28data%20%21%3D%3D%20null%29%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20JSHint%20WARNING%3A%20Do%20not%20change%20dataSocketID%20%21%3D%20null%20to%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20data.socketID%20%21%3D%3D%20null%20because%20it%20will%20cause%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20org/terraswarm/accessor/test/auto/WebSocketClient.xml%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20to%20fail%20upon%20reloading.%20%20See%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20org/terraswarm/accessor/test/WebSocketClientTest.tcl%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%28data.socketID%20%21%3D%20null%29%20%26%26%20%28data.message%20%21%3D%3D%20null%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20data%20has%20the%20right%20form%20for%20a%20point-to-point%20send.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28self.sockets%5Bdata.socketID%5D%20%26%26%20self.sockets%5Bdata.socketID%5D.isOpen%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20id%20matches%20this%20socket.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log%28self.accessorName%20+%20%27%3A%20WebSocketServer%3A%20Sending%20to%20socket%20id%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data.socketID%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20message%3A%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data.message%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*/%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.sockets%5Bdata.socketID%5D.send%28data.message%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log%28self.accessorName%20+%20%27%3A%20WebSocketServer.js%3A%20Socket%20with%20ID%20%27%20+%20data.socketID%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20is%20not%20open.%20Discarding%20message.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20No%20socketID%20or%20message%2C%20so%20this%20is%20a%20broadcast%20message.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20var%20success%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28id%20%3D%200%3B%20id%20%3C%20self.sockets.length%3B%20id%20+%3D%201%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28self.sockets%5Bid%5D.isOpen%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20console.log%28self.accessorName%20+%20%27WebSocketServer.js%3A%20Broadcasting%20to%20socket%20id%20%27%20+%20id%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20%20%20%20%20+%20%27%20message%3A%20%27%20+%20data%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.sockets%5Bid%5D.send%28data%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20success%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20%28%21success%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%20%20%20%20console.log%28self.accessorName%20+%20%27WebSocketServer.js%3A%20No%20open%20sockets.%20Discarding%20message%3A%20%27%20+%20data.message%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%29%3B%0A%7D%3B%0A%0Aexports.onListening%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20if%20%28debug%29%20%7B%0A%20%20%20%20%20%20%20%20console.log%28this.accessorName%20+%20%27WebSocketServer.js%3A%20Listening%20for%20socket%20connection%20requests.%27%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20this.send%28%27listening%27%2C%20this.getParameter%28%27port%27%29%29%3B%0A%7D%3B%0A%0A/**%20Executes%20when%20a%20connection%20has%20been%20established.%3Cbr%3E%0A%20*%20%20Triggers%20an%20output%20on%20%3Ccode%3E%27connection%27%3C/code%3E.%0A%20*%20%20Adds%20an%20event%20listener%20to%20the%20socket.%20*/%0Aexports.onConnection%20%3D%20function%20%28socket%29%20%7B%0A%20%20%20%20//%20socketID%20is%20the%20index%20of%20the%20socket%20in%20the%20sockets%20array.%0A%20%20%20%20var%20self%20%3D%20this%2C%0A%20%20%20%20%20%20%20%20socketID%20%3D%20self.sockets.length%3B%0A%20%20%20%20if%20%28debug%29%20%7B%0A%20%20%20%20%20%20%20%20console.log%28this.accessorName%20+%20%27WebSocketServer.js%3A%20new%20socket%20established%20with%20ID%3A%20%27%20+%20socketID%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20this.send%28%27connection%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27socketID%27%3A%20socketID%2C%0A%20%20%20%20%20%20%20%20%27status%27%3A%20%27open%27%0A%20%20%20%20%7D%29%3B%0A%0A%20%20%20%20self.sockets.push%28socket%29%3B%0A%0A%20%20%20%20self.sockets%5BsocketID%5D.on%28%27message%27%2C%20function%20%28message%29%20%7B%0A%20%20%20%20%20%20%20%20console.log%28%27WebSocketServer%20message%28%29%3A%20%27%20+%20message%20+%20%27%2C%20typeof%20message%3A%20%27%20+%20typeof%20message%29%3B%0A%20%20%20%20%20%20%20%20//%20For%20some%20reason%2C%20under%20the%20Node%20Host%2C%20the%20message%20is%20an%0A%20%20%20%20%20%20%20%20//%20object.%20%20Under%20CapeCode%2C%20it%20is%20a%20string%3F%0A%20%20%20%20%20%20%20%20var%20isObjectWithQuotes%20%3D%20%28typeof%20message%20%3D%3D%3D%20%27object%27%20%26%26%20message.toString%28%29.startsWith%28%27%22%27%29%20%26%26%20message.toString%28%29.endsWith%28%27%22%27%29%29%3B%0A%20%20%20%20%20%20%20%20//%20If%20message%20is%20a%20string%2C%20strip%20leading%20and%20trailing%20%22%0A%20%20%20%20%20%20%20%20if%20%28typeof%20message%20%3D%3D%3D%20%27string%27%20%7C%7C%20isObjectWithQuotes%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28isObjectWithQuotes%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20message%20%3D%20message.toString%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20message%20%3D%20message.replace%28/%5E%22%28.*%29%22%24/%2C%20%27%241%27%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20self.send%28%27received%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%27message%27%3A%20message%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27socketID%27%3A%20socketID%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20self.sockets%5BsocketID%5D.on%28%27close%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20self.send%28%27connection%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%27socketID%27%3A%20socketID%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%27status%27%3A%20%27closed%27%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20self.sockets%5BsocketID%5D.on%28%27error%27%2C%20function%20%28message%29%20%7B%0A%20%20%20%20%20%20%20%20console.log%28self.accessorName%20+%20%27%3A%20WebSocketServer.js%3A%20error%20%27%20+%20message%29%3B%0A%20%20%20%20%20%20%20%20self.error%28message%29%3B%0A%20%20%20%20%7D%29%3B%0A%0A%0A%7D%3B%0A%0A/**%20Removes%20all%20inputHandlers%20from%20sockets.%3Cbr%3E%0A%20*%20Unregisters%20event%20listeners%20from%20sockets.%3Cbr%3E%0A%20*%20Closes%20server.%0A%20*/%0Aexports.wrapup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.sockets%20%3D%20%5B%5D%3B%0A%0A%20%20%20%20if%20%28server%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20server.stop%28%29%3B%0A%20%20%20%20%20%20%20%20server%20%3D%20null%3B%0A%20%20%20%20%7D%0A%7D%3B%0A'));
    WebSocketServer.setParameter('hostInterface', "localhost");
    WebSocketServer.setParameter('port', 8090);
    WebSocketServer.setParameter('pfxKeyCertPassword', "");
    WebSocketServer.setParameter('pfxKeyCertPath', "");
    WebSocketServer.setParameter('receiveType', "text/plain");
    WebSocketServer.setParameter('sendType', "text/plain");
    WebSocketServer.setParameter('sslTls', false);

    // Start: TestDisplay: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: TestDisplay: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var TestDisplay = this.instantiateFromCode('TestDisplay', unescape('//%20Display%20data%20on%20the%20console.%0A//%0A//%20Copyright%20%28c%29%202016-2016%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A//%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A//%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A//%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A//%0A%0A/**%20Display%20data%20on%20the%20console%20using%20util.inspect%28%29.%0A%20*%0A%20*%20%20@accessor%20test/TestDisplay%0A%20*%20%20@param%20input%20The%20output%0A%20*%20%20@author%20Christopher%20Brooks%0A%20*%20%20@version%20%24%24Id%3A%20TestDisplay.js%202003%202017-08-03%2014%3A47%3A31Z%20eal%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint.%20%20Note%20that%20there%20should%20be%20no%0A//%20space%20between%20the%20/%20and%20the%20*%20and%20global.%0A/*globals%20console%2C%20error%2C%20exports%2C%20require%20*/%0A/*jshint%20globalstrict%3A%20true*/%0A%22use%20strict%22%3B%0A%0Avar%20util%20%3D%20require%28%27util%27%29%3B%0A%0Aexports.setup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.input%28%27input%27%29%3B%0A%20%20%20%20this.output%28%27output%27%29%3B%0A%7D%3B%0A%0Aexports.initialize%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.addInputHandler%28%27input%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20var%20inputValue%20%3D%20this.get%28%27input%27%29%3B%0A%20%20%20%20%20%20%20%20console.log%28util.inspect%28inputValue%29%29%3B%0A%20%20%20%20%20%20%20%20this.send%28%27output%27%2C%20inputValue%29%3B%0A%20%20%20%20%7D%29%3B%0A%7D%3B%0A'));

    // Connections: WebSocketLog: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/TypedCompositeActor.java
    this.connect(TestSpontaneous, 'output', WebSocketServer, 'toSend');
    this.connect(WebSocketServer, 'connection', TestDisplay, 'input');
};

// To update the initialize code below, modify
//   $PTII/ptolemy/cg/kernel/generic/accessor/AccessorCodeGenerator.java
if (exports.initialize) {
    var originalInitialize = exports.initialize;
    exports.initialize = function() {
        originalInitialize.call(this);
        this.stopAt(10000.0);
    }
} else {
    exports.initialize = function() {
        this.stopAt(10000.0);
    }
}
