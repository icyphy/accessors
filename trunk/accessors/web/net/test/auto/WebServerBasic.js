exports.setup = function () {
    //  This composite accessor was created by Cape Code.
    //  To run the code, run: 
    //  (cd $PTII/org/terraswarm/accessor/accessors/web/net/test/auto; node ../../../node_modules/@accessors-hosts/node/nodeHostInvoke.js  net/test/auto/WebServerBasic)
    //  To regenerate this composite accessor, run:
    //  $PTII/bin/ptinvoke ptolemy.cg.kernel.generic.accessor.AccessorCodeGenerator -language accessor $PTII/./ptolemy/actor/lib/jjs/modules/httpServer/test/auto/WebServerBasic.xml
    //  to edit the model, run:
    //  $PTII/bin/capecode $PTII/./ptolemy/actor/lib/jjs/modules/httpServer/test/auto/WebServerBasic.xml

    // Ports: WebServerBasic: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/TypedCompositeActor.java

    // Start: WebServer: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: WebServer: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var WebServer = this.instantiateFromCode('WebServer', unescape('//%20Copyright%20%28c%29%202017%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A%0A/**%20This%20accessor%20starts%20a%20server%20that%20listens%20for%20HTTP%20requests%0A%20*%20%20on%20the%20specified%20hostInterface%20and%20port%20and%20issues%20responses.%0A%20*%20%20The%20hostInterface%20specifies%20what%20network%20interface%20%28e.g.%20Ethernet%2C%0A%20*%20%20WiFi%2C%20or%20localhost%29%20to%20use.%20The%20default%20is%20%27localhost%27%2C%20which%20%28usually%29%0A%20*%20%20means%20that%20the%20server%20listens%20only%20for%20requests%20coming%20from%20the%20local%20machine.%0A%20*%20%20This%20is%20useful%20for%20testing.%20To%20listen%20for%20requests%20on%20all%20IPv4%20addresses%20on%0A%20*%20%20the%20local%20machine%2C%20specify%20%270.0.0.0%27.%20This%20will%20make%20the%20server%20accessible%0A%20*%20%20to%20any%20machine%20that%20has%20access%20to%20an%20IP%20address%20for%20the%20local%20machine.%0A%20*%0A%20*%20%20When%20this%20server%20receives%20an%20http%20requests%20from%20the%20network%20%28or%20from%0A%20*%20%20the%20local%20machine%29%2C%20it%20produces%20a%20JavaScript%20object%20on%20the%20output%20that%0A%20*%20%20includes%20at%20least%20the%20following%20properties%3A%0A%20*%20%20%0A%20*%20%20*%20body%3A%20The%20body%20of%20the%20request%2C%20or%20null%20if%20there%20is%20no%20body.%0A%20*%20%20*%20method%3A%20A%20string%20that%20describes%20the%20HTTP%20method%20of%20the%20request%2C%20which%0A%20*%20%20%20%20may%20be%20%22GET%22%2C%20%22PUT%22%2C%20etc.%0A%20*%20%20*%20path%3A%20The%20path%20in%20the%20URL%20of%20the%20request%2C%20such%20as%20%22/%22%20when%20there%20is%20no%0A%20*%20%20%20%20path.%0A%20*%20%20*%20requestID%3A%20An%20identifier%20for%20the%20request.%0A%20*%20%20%0A%20*%0A%20*%20%20To%20produce%20a%20response%2C%20this%20accessor%20waits%20for%20an%20input%20on%20its%20*response*%0A%20*%20%20port%20that%20is%20a%20JavaScript%20object%20containing%20the%20following%20properties%3A%0A%20*%20%20%0A%20*%20%20*%20requestID%3A%20An%20identifier%20matching%20a%20request%20for%20which%20a%20response%20has%20not%0A%20*%20%20%20%20already%20been%20issued.%0A%20*%20%20*%20response%3A%20The%20body%20of%20the%20response%2C%20such%20as%20HTML%20to%20display%20to%20the%0A%20*%20%20%20%20requester%20or%20a%20JavaScript%20object%20with%20a%20JSON%20representation%20%28the%20JSON%0A%20*%20%20%20%20representation%20will%20be%20sent%20back%20as%20the%20response%29.%20If%20this%20property%20is%0A%20*%20%20%20%20not%20included%20in%20the%20input%2C%20then%20the%20input%20will%20be%20stringified%20as%20a%20JSON%0A%20*%20%20%20%20object%20and%20sent.%20This%20will%20include%20the%20requestID%20property.%0A%20*%20%20%0A%20*%0A%20*%20%20If%20there%20is%20no%20pending%20request%20with%20a%20matching%20ID%2C%20then%20an%20error%20will%20be%0A%20*%20%20issued.%0A%20*%20%20%0A%20*%20%20A%20simple%20use%20case%20is%20to%20connect%20the%20*request*%20output%20to%20some%20other%20actor%0A%20*%20%20that%20generates%20a%20response%2C%20and%20then%20to%20feed%20that%20response%20back%20to%20the%0A%20*%20%20*response*%20input.%20Be%20sure%20to%20include%20the%20requestID%20property%20in%20the%20response.%0A%20*%0A%20*%20%20When%20%60wrapup%28%29%60%20is%20invoked%2C%20this%20accessor%20closes%20the%20%20server.%0A%20*%0A%20*%20%20This%20accessor%20requires%20the%20module%20httpServer.%0A%20*%0A%20*%20%20@accessor%20net/WebServer%0A%20*%20%20@parameter%20%7Bstring%7D%20hostInterface%20The%20IP%20address%20or%20domain%20name%20of%20the%0A%20*%20%20%20%20network%20interface%20to%20listen%20to.%0A%20*%20%20@parameter%20%7Bint%7D%20port%20The%20port%20to%20listen%20on.%0A%20*%0A%20*%20%20@input%20response%20The%20response%20to%20issue%20to%20a%20request.%20%0A%20*%20%20@input%20shutdown%20Shutdown%20the%20web%20server.%0A%20*%20%20@output%20%7Bint%7D%20listening%20When%20the%20server%20is%20listening%20for%20connections%2C%20this%20output%0A%20*%20%20%20%20will%20produce%20the%20port%20number%20that%20the%20server%20is%20listening%20on%0A%20*%20%20@output%20request%20The%20request%20that%20came%20into%20the%20server.%0A%20*%20%20%0A%20*%20%20@author%20Edward%20A.%20Lee%20amd%20Elizabeth%20Osyk%0A%20*%20%20@version%20%24%24Id%3A%20WebServer.js%202147%202017-09-20%2005%3A06%3A10Z%20cxh%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint%20and%20jshint.%20%20Note%20that%20there%20should%0A//%20be%20no%20space%20between%20the%20/%20and%20the%20*%20and%20global.%20See%0A//%20https%3A//chess.eecs.berkeley.edu/ptexternal/wiki/Main/JSHint%20*/%0A/*globals%20console%2C%20error%2C%20exports%2C%20require%20*/%0A/*jshint%20globalstrict%3A%20true*/%0A%27use%20strict%27%3B%0A%0Avar%20httpServer%20%3D%20require%28%27@accessors-modules/http-server%27%29%3B%0Avar%20util%20%3D%20require%28%27util%27%29%3B%0A%0A/**%20Sets%20up%20the%20accessor%20by%20defining%20inputs%20and%20outputs.%20*/%0Aexports.setup%20%3D%20function%28%29%20%7B%0A%20%20%20%20this.parameter%28%27hostInterface%27%2C%20%7B%0A%20%20%20%20%20%20%20%20value%3A%20%22localhost%22%2C%0A%20%20%20%20%20%20%20%20type%3A%20%22string%22%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27port%27%2C%20%7B%0A%20%20%20%20%20%20%20%20value%3A%2080%2C%0A%20%20%20%20%20%20%20%20type%3A%20%22int%22%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.input%28%27response%27%29%3B%0A%20%20%20%20this.output%28%27listening%27%2C%20%7B%27type%27%3A%27int%27%7D%29%3B%0A%20%20%20%20this.output%28%27request%27%2C%20%7B%27spontaneous%27%3A%20true%7D%29%3B%0A%7D%3B%0A%0A/**%20Starts%20the%20server.%0A%20*/%0Aexports.initialize%20%3D%20function%28%29%20%7B%0A%20%20%20%20var%20self%20%3D%20this%3B%0A%20%20%20%20%0A%20%20%20%20if%20%28%21self.server%29%20%7B%0A%20%20%20%20%20%20%20%20console.log%28%27WebServer%3A%20Creating%20new%20server.%27%29%3B%0A%20%20%20%20%20%20%20%20self.server%20%3D%20new%20httpServer.HttpServer%28%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27port%27%3A%20self.getParameter%28%27port%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27hostInterface%27%3A%20self.getParameter%28%27hostInterface%27%29%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20//%20Using%20%27self.exports%27%20rather%20than%20just%20%27exports%27%20in%20the%20following%20allows%0A%20%20%20%20%20%20%20%20//%20these%20functions%20to%20be%20overridden%20in%20derived%20accessors.%0A%20%20%20%20%20%20%20%20self.server.on%28%27listening%27%2C%20self.exports.onListening.bind%28self%29%29%3B%0A%20%20%20%20%20%20%20%20self.server.on%28%27request%27%2C%20self.exports.request.bind%28self%29%29%3B%0A%20%20%20%20%20%20%20%20self.server.on%28%27error%27%2C%20function%20%28message%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.error%28message%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20self.server.start%28%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20self.addInputHandler%28%27response%27%2C%20function%28%29%20%7B%0A%20%20%20%20%20%20%20%20var%20response%20%3D%20self.get%28%27response%27%29%3B%0A%20%20%20%20%20%20%20%20if%20%28%21response.hasOwnProperty%28%27requestID%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20error%28%27Response%20has%20no%20requestID%20property.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20var%20id%20%3D%20response.requestID%3B%0A%20%20%20%20%20%20%20%20if%20%28%21self.pendingRequests.hasOwnProperty%28id%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20error%28%27No%20pending%20request%20with%20ID%20%27%20+%20id%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20delete%20self.pendingRequests%5Bid%5D%3B%0A%20%20%20%20%20%20%20%20//%20Default%20body%20of%20the%20response%20is%20the%20whole%20response%20object.%0A%20%20%20%20%20%20%20%20var%20body%20%3D%20response%3B%0A%20%20%20%20%20%20%20%20if%20%28response.hasOwnProperty%28%27response%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20body%20%3D%20response.response%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28typeof%20body%20%21%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20body%20%3D%20JSON.stringify%28body%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20%28response.hasOwnProperty%28%27responseCode%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20%09this.server.respond%28response.requestID%2C%20body%2C%20response.responseCode%29%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%09this.server.respond%28response.requestID%2C%20body%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20%0A%20%20%20%20//%20Initialize%20pendingRequests%20to%20an%20empty%20object.%0A%20%20%20%20self.pendingRequests%20%3D%20%7B%7D%3B%0A%7D%3B%0A%0Aexports.onListening%20%3D%20function%28%29%20%7B%0A%20%20%20%20console.log%28%27WebServer%3A%20Listening%20for%20requests.%27%29%3B%0A%20%20%20%20this.send%28%27listening%27%2C%20this.getParameter%28%27port%27%29%29%3B%0A%7D%3B%0A%0Aexports.request%20%3D%20function%28request%29%20%7B%0A%20%20%20%20console.log%28%27Server%20received%20request%3A%20%27%20+%20util.inspect%28request%29%29%3B%0A%20%20%20%20if%20%28this.server%29%20%7B%0A%20%20%20%20%20%20%20%20this.send%28%27request%27%2C%20request%29%3B%0A%20%20%20%20%20%20%20%20this.pendingRequests%5Brequest.requestID%5D%20%3D%20request%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20console.log%28%27WARNING%3A%20server%20does%20not%20exist.%27%29%3B%0A%20%20%20%20%7D%0A%7D%3B%0A%0A/**%20Removes%20all%20inputHandlers%20from%20sockets.%3Cbr%3E%0A%20*%20Unregisters%20event%20listeners%20from%20sockets.%3Cbr%3E%0A%20*%20Closes%20server.%0A%20*/%0Aexports.wrapup%20%3D%20function%28%29%7B%0A%20%20%20%20if%20%28this.server%20%21%3D%3D%20null%20%26%26%20typeof%20this.server%20%21%3D%3D%20%27undefined%27%29%20%7B%0A%20%20%20%20%20%20%20%20console.log%28%27WebServer%3A%20Stopping%20the%20server.%27%29%3B%0A%20%20%20%20%20%20%20%20this.server.removeAllListeners%28%29%3B%0A%20%20%20%20%20%20%20%20this.server.stop%28%29%3B%0A%20%20%20%20%20%20%20%20this.server%20%3D%20null%3B%0A%20%20%20%20%7D%0A%7D%3B%0A'));
    WebServer.setParameter('hostInterface', "localhost");
    WebServer.setParameter('port', 8096);

    // Start: REST: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: REST: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var REST = this.instantiateFromCode('REST', unescape('//%20Accessor%20for%20%20Representational%20State%20Transfer%20%28RESTful%29%20interfaces.%0A%0A//%20Copyright%20%28c%29%202015-2017%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A//%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A//%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A//%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A//%0A%0A/**%20Accessor%20for%20RESTful%20interfaces.%0A%20*%20%20Upon%20receipt%20of%20a%20trigger%20input%2C%20this%20accessor%20will%20issue%20an%20HTTP%20request%0A%20*%20%20specified%20by%20the%20inputs.%20Some%20time%20later%2C%20the%20accessor%20will%20receive%20a%20response%0A%20*%20%20from%20the%20server%20or%20a%20timeout.%20In%20the%20first%20case%2C%20the%20accessor%20will%20produce%0A%20*%20%20the%20response%20%28body%2C%20status%20code%2C%20and%20headers%29%20on%20output%20ports.%0A%20*%20%20In%20the%20second%20case%2C%20it%20will%20produce%20a%20nil%20output%20on%20the%20response%20port%0A%20*%20%20and%20an%20error.%0A%20*%0A%20*%20%20The%20accessor%20does%20not%20block%20waiting%20for%20the%20response%2C%20but%20any%20additional%0A%20*%20%20triggered%20requests%20will%20be%20queued%20to%20be%20issued%20only%20after%20the%20pending%20request%0A%20*%20%20has%20received%20either%20a%20response%20or%20a%20timeout.%20This%20strategy%20ensures%20that%20outputs%0A%20*%20%20from%20this%20accessor%20are%20produced%20in%20the%20same%20order%20as%20the%20inputs%20that%20trigger%20the%0A%20*%20%20HTTP%20requests.%0A%20*%0A%20*%20%20The%20%3Ci%3Eoptions%3C/i%3E%20input%20can%20be%20a%20string%20URL%20%28with%20surrounding%20quotation%20marks%29%0A%20*%20%20or%20an%20object%20with%20the%20following%20fields%3A%0A%20*%20%20%3Cul%3E%0A%20*%20%20%3Cli%3E%20headers%3A%20An%20object%20containing%20request%20headers.%20By%20default%20this%0A%20*%20%20%20%20%20%20%20is%20an%20empty%20object.%20Items%20may%20have%20a%20value%20that%20is%20an%20array%20of%20values%2C%0A%20*%20%20%20%20%20%20%20for%20headers%20with%20more%20than%20one%20value.%0A%20*%20%20%3Cli%3E%20keepAlive%3A%20A%20boolean%20that%20specified%20whether%20to%20keep%20sockets%20around%0A%20*%20%20%20%20%20%20%20in%20a%20pool%20to%20be%20used%20by%20other%20requests%20in%20the%20future.%20This%20defaults%20to%20false.%0A%20*%20%20%3Cli%3E%20method%3A%20A%20string%20specifying%20the%20HTTP%20request%20method.%0A%20*%20%20%20%20%20%20%20This%20defaults%20to%20%27GET%27%2C%20but%20can%20also%20be%20%27PUT%27%2C%20%27POST%27%2C%20%27DELETE%27%2C%20etc.%0A%20*%20%20%3Cli%3E%20url%3A%20A%20string%20that%20can%20be%20parsed%20as%20a%20URL%2C%20or%20an%20object%20containing%0A%20*%20%20%20%20%20%20%20the%20following%20fields%3A%0A%20*%20%20%20%20%20%20%20%3Cul%3E%0A%20*%20%20%20%20%20%20%20%3Cli%3E%20host%3A%20A%20string%20giving%20the%20domain%20name%20or%20IP%20address%20of%0A%20*%20%20%20%20%20%20%20%20%20%20%20%20the%20server%20to%20issue%20the%20request%20to.%20This%20defaults%20to%20%27localhost%27.%0A%20*%20%20%20%20%20%20%20%3Cli%3E%20protocol%3A%20The%20protocol.%20This%20is%20a%20string%20that%20defaults%20to%20%27http%27.%0A%20*%20%20%20%20%20%20%20%3Cli%3E%20port%3A%20Port%20of%20remote%20server.%20This%20defaults%20to%2080.%0A%20*%20%20%20%20%20%20%20%3C/ul%3E%0A%20*%20%20%3C/ul%3E%0A%20*%0A%20*%20%20For%20example%2C%20the%20%3Ci%3Eoptions%3C/i%3E%20parameter%20could%20be%20set%20to%0A%20*%20%20%3Ccode%3E%0A%20*%20%20%7B%22headers%22%3A%7B%22Content-Type%22%3A%22application/x-www-form-urlencoded%22%7D%2C%20%22method%22%3A%22POST%22%2C%20%22url%22%3A%22...%22%7D%0A%20*%20%20%3C/code%3E%0A%20*%0A%20*%20%20In%20addition%2C%20there%20is%20a%20%3Ci%3Ecommand%3C/i%3E%20input%20that%20is%20a%20string%20that%20is%20appended%0A%20*%20%20as%20a%20path%20to%20the%20URL%20constructed%20from%20the%20%3Ci%3Eoptions%3C/i%3E%20input.%20This%20defaults%0A%20*%20%20to%20the%20empty%20string.%0A%20*%0A%20*%20%20The%20%3Ci%3Earguments%3C/i%3E%20input%20an%20object%20with%20fields%20that%20are%20converted%20to%20a%20query%0A%20*%20%20string%20to%20append%20to%20the%20url%2C%20for%20example%20%27%3Farg%3Dvalue%27.%20If%20the%20value%20contains%0A%20*%20%20characters%20that%20are%20not%20allowed%20in%20a%20URL%2C%20such%20as%20spaces%2C%20they%20will%20encoded%0A%20*%20%20according%20to%20the%20ASCII%20standard%2C%20see%20http%3A//www.w3schools.com/tags/ref_urlencode.asp%20.%0A%20*%0A%20*%20%20A%20%3Ci%3Etrigger%3C/i%3E%20input%20triggers%20invocation%20of%20the%20current%20command.%20Any%20value%20provided%0A%20*%20%20on%20the%20trigger%20input%20is%20ignored.%0A%20*%0A%20*%20%20The%20output%20response%20will%20be%20a%20string%20if%20the%20MIME%20type%20of%20the%20accessed%20page%0A%20*%20%20begins%20with%20%22text%22.%20If%20the%20MIME%20type%20begins%20with%20anything%20else%2C%20then%20the%0A%20*%20%20binary%20data%20will%20be%20produced.%20It%20is%20up%20to%20the%20host%20implementation%20to%20ensure%0A%20*%20%20that%20the%20data%20is%20given%20in%20some%20form%20that%20is%20usable%20by%20downstream%20accessors%0A%20*%20%20or%20actors.%0A%20*%0A%20*%20%20The%20parameter%20%27timeout%27%20specifies%20how%20long%20this%20accessor%20will%20wait%20for%20response.%0A%20*%20%20If%20it%20does%20not%20receive%20the%20response%20by%20the%20specified%20time%2C%20then%20it%20will%20issue%0A%20*%20%20a%20null%20response%20output%20and%20an%20error%20event%20%28calling%20the%20error%28%29%20function%20of%20the%20host%29.%0A%20*%0A%20*%20%20If%20the%20parameter%20%27outputCompleteResponseOnly%27%20is%20true%20%28the%20default%29%2C%20then%20this%0A%20*%20%20accessor%20will%20produce%20a%20%27response%27%20output%20only%20upon%20receiving%20a%20complete%20response.%0A%20*%20%20If%20it%20is%20false%2C%20then%20multiple%20outputs%20may%20result%20from%20a%20single%20input%20or%20trigger.%0A%20*%0A%20*%20%20@accessor%20net/REST%0A%20*%20%20@author%20Edward%20A.%20Lee%20%28eal@eecs.berkeley.edu%29%2C%20contributor%3A%20Christopher%20Brooks%0A%20*%20%20@input%20%7BJSON%7D%20options%20The%20url%20for%20the%20command%20or%20an%20object%20specifying%20options.%0A%20*%20%20@input%20%7Bstring%7D%20command%20The%20command.%0A%20*%20%20@input%20%7BJSON%7D%20arguments%20Arguments%20to%20the%20command.%0A%20*%20%20@input%20body%20The%20request%20body%2C%20if%20any.%20%20This%20supports%20at%20least%20strings%20and%20image%20data.%0A%20*%20%20@input%20trigger%20An%20input%20to%20trigger%20the%20command.%0A%20*%20%20@output%20%7Bstring%7D%20response%20The%20server%27s%20response.%0A%20*%20%20@output%20%7Bstring%7D%20status%20The%20status%20code%20and%20message%20of%20the%20response.%0A%20*%20%20@output%20headers%20The%20headers%20sent%20with%20the%20response.%0A%20*%20%20@parameter%20%7Bint%7D%20timeout%20The%20amount%20of%20time%20%28in%20milliseconds%29%20to%20wait%20for%20a%20response%0A%20*%20%20%20before%20triggering%20a%20null%20response%20and%20an%20error.%20This%20defaults%20to%205000.%0A%20*%20%20@parameter%20%7Bboolean%7D%20outputCompleteResponseOnly%20If%20true%20%28the%20default%29%2C%20the%20produce%20a%0A%20*%20%20%20%27response%27%20output%20only%20upon%20receiving%20the%20entire%20response.%0A%20*%20%20@version%20%24%24Id%3A%20REST.js%202050%202017-08-15%2014%3A22%3A03Z%20cxh%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint%20and%20jshint.%20%20Note%20that%20there%20should%0A//%20be%20no%20space%20between%20the%20/%20and%20the%20*%20and%20global.%20See%0A//%20https%3A//chess.eecs.berkeley.edu/ptexternal/wiki/Main/JSHint%20*/%0A/*globals%20addInputHandler%2C%20error%2C%20exports%2C%20get%2C%20input%2C%20output%2C%20parameter%2C%20require%2C%20send%20*/%0A/*jshint%20globalstrict%3A%20true*/%0A%27use%20strict%27%3B%0A%0Avar%20httpClient%20%3D%20require%28%27@accessors-modules/http-client%27%29%3B%0Avar%20querystring%20%3D%20require%28%27querystring%27%29%3B%0A%0A/**%20Define%20inputs%20and%20outputs.%20*/%0Aexports.setup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.input%28%27options%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%27type%27%3A%20%27JSON%27%2C%20%20%20%20%20%20%20%20//%20Note%20that%20string%20literals%20are%20valid%20JSON.%0A%20%20%20%20%20%20%20%20%27value%27%3A%20%27%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.input%28%27command%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27string%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%20%27%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.input%28%27arguments%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27JSON%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%20%27%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.input%28%27trigger%27%29%3B%0A%20%20%20%20this.input%28%27body%27%29%3B%0A%20%20%20%20this.output%28%27response%27%29%3B%0A%20%20%20%20this.output%28%27status%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27string%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.output%28%27headers%27%29%3B%0A%20%20%20%20this.parameter%28%27timeout%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27value%27%3A%205000%2C%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27int%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27outputCompleteResponseOnly%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27value%27%3A%20true%2C%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27boolean%27%0A%20%20%20%20%7D%29%3B%0A%7D%3B%0A%0A/**%20Build%20the%20path%20from%20the%20command%20and%20arguments.%0A%20*%20%20This%20default%20implementation%20returns%20%27command%3Fargs%27%2C%20where%0A%20*%20%20args%20is%20an%20encoding%20of%20the%20arguments%20input%20for%20embedding%20in%20a%20URL.%0A%20*%20%20For%20example%2C%20if%20the%20arguments%20input%20is%20the%20object%0A%20*%20%20%20%20%20%60%60%60%7B%20foo%3A%20%27bar%27%2C%20baz%3A%20%5B%27qux%27%2C%20%27quux%27%5D%2C%20corge%3A%20%27%27%20%7D%60%60%60%0A%20*%20%20then%20the%20returned%20string%20will%20be%0A%20*%20%20%20%20%20%60%60%60command%3Ffoo%3Dbar%26baz%3Dqux%26baz%3Dquux%26corge%3D%60%60%60%0A%20*%20%20Derived%20accessors%20may%20override%20this%20function%20to%20customize%0A%20*%20%20the%20interaction.%20The%20returned%20string%20should%20not%20include%20a%20leading%20%27/%27.%0A%20*%20%20That%20will%20be%20added%20automatically.%0A%20*/%0Aexports.encodePath%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20//%20Remove%20any%20leading%20slash%20that%20might%20be%20present.%0A%20%20%20%20%20%20%20%20var%20re%20%3D%20new%20RegExp%28%27%5E%5C/%27%29%3B%0A%20%20%20%20%20%20%20%20var%20command%20%3D%20this.get%28%27command%27%29.replace%28re%2C%20%27%27%29%3B%0A%20%20%20%20//%20Encode%20any%20characters%20that%20are%20not%20allowed%20in%20a%20URL.%0A%20%20%20%20var%20encodedArgs%20%3D%20querystring.stringify%28this.get%28%27arguments%27%29%29%3B%0A%20%20%20%20if%20%28encodedArgs%29%20%7B%0A%20%20%20%20%20%20%20%20return%20command%20+%20%27%3F%27%20+%20encodedArgs%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20command%3B%0A%7D%3B%0A%0A/**%20Filter%20the%20response.%20This%20base%20class%20just%20returns%20the%20argument%0A%20*%20%20unmodified%2C%20but%20derived%20classes%20can%20override%20this%20to%20extract%0A%20*%20%20a%20portion%20of%20the%20response%2C%20for%20example.%20Note%20that%20the%20response%0A%20*%20%20argument%20can%20be%20null%2C%20indicating%20that%20there%20was%20no%20response%0A%20*%20%20%28e.g.%2C%20a%20timeout%20or%20error%20occurred%29.%0A%20*%20%20@param%20response%20The%20response%2C%20or%20null%20if%20there%20is%20none.%0A%20*/%0Aexports.filterResponse%20%3D%20function%20%28response%29%20%7B%0A%20%20%20%20return%20response%3B%0A%7D%3B%0A%0A//%20Keep%20track%20of%20pending%20HTTP%20request%20so%20it%20can%20be%20stopped%20if%20the%0A//%20model%20stops%20executing.%0Avar%20request%3B%0A%0A/**%20Issue%20the%20command%20based%20on%20the%20current%20value%20of%20the%20inputs.%0A%20*%20%20This%20constructs%20a%20path%20using%20encodePath%20and%20combines%20it%20with%20the%0A%20*%20%20url%20input%20to%20construct%20the%20full%20command.%0A%20*%20%20@param%20callback%20The%20callback%20function%20that%20will%20be%20called%20with%20the%0A%20*%20%20%20response%20as%20an%20argument%20%28an%20instance%20of%20IncomingMessage%2C%20defined%20in%0A%20*%20%20%20the%20httpClient%20module%29.%0A%20*/%0Aexports.issueCommand%20%3D%20function%20%28callback%29%20%7B%0A%20%20%20%20var%20encodedPath%20%3D%20this.exports.encodePath.call%28this%29%3B%0A%20%20%20%20var%20options%20%3D%20this.get%28%27options%27%29%3B%0A%20%20%20%20var%20body%20%3D%20this.get%28%27body%27%29%3B%0A%20%20%20%20var%20command%20%3D%20options%3B%0A%20%20%20%20if%20%28typeof%20options%20%3D%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20//%20In%20order%20to%20be%20able%20to%20include%20the%20outputCompleteResponseOnly%0A%20%20%20%20%20%20%20%20//%20option%2C%20we%20have%20to%20switch%20styles%20here.%0A%20%20%20%20%20%20%20%20command%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20if%20%28encodedPath%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20command.url%20%3D%20options%20+%20%27/%27%20+%20encodedPath%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20command.url%20%3D%20options%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20//%20Don%27t%20use%20command%20%3D%20options%2C%20because%20otherwise%20if%20we%20invoke%0A%20%20%20%20%20%20%20%20//%20this%20accessor%20multiple%20times%2C%20then%20options.url%20will%20be%0A%20%20%20%20%20%20%20%20//%20appended%20to%20each%20time.%20%20Instead%2C%20do%20a%20deep%20clone.%0A%20%20%20%20%20%20%20%20command%20%3D%20JSON.parse%28JSON.stringify%28options%29%29%3B%0A%20%20%20%20%20%20%20%20if%20%28typeof%20options.url%20%3D%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20command.url%20%3D%20options.url%20+%20%27/%27%20+%20encodedPath%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20command.url.path%20%3D%20%27/%27%20+%20encodedPath%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20command.timeout%20%3D%20this.getParameter%28%27timeout%27%29%3B%0A%0A%20%20%20%20if%20%28this.getParameter%28%27outputCompleteResponseOnly%27%29%20%3D%3D%3D%20false%29%20%7B%0A%20%20%20%20%20%20%20%20command.outputCompleteResponseOnly%20%3D%20false%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20%28typeof%20body%20%21%3D%3D%20%27undefined%27%29%20%7B%0A%20%20%20%20%20%20%20%20command.body%20%3D%20body%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20//%20console.log%28%22REST.js%20issueCommand%28%29%3A%20request%20to%3A%20%22%20+%20JSON.stringify%28command%29%29%3B%0A%20%20%20%20//%20var%20util%20%3D%20require%28%27util%27%29%3B%20%0A%20%20%20%20//%20console.log%28util.inspect%28command%29%29%3B%0A%20%20%20%20%0A%20%20%20%20request%20%3D%20httpClient.request%28command%2C%20callback%29%3B%0A%20%20%20%20request.on%28%27error%27%2C%20function%20%28message%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28%21message%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20message%20%3D%20%27Request%20failed.%20No%20further%20information.%27%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20error%28message%29%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20request.end%28%29%3B%0A%7D%3B%0A%0A/**%20Handle%20the%20response%20from%20the%20RESTful%20service.%20The%20argument%0A%20*%20%20is%20expected%20to%20be%20be%20an%20instance%20of%20IncomingMessage%2C%20defined%0A%20*%20%20in%20the%20httpClient%20module.%20This%20base%20class%20extracts%20the%20body%0A%20*%20%20field%20of%20the%20message%2C%20if%20there%20is%20one%2C%20and%20produces%20that%20on%0A%20*%20%20the%20%27response%27%20output%2C%20and%20otherwise%20just%20produces%20the%20message%0A%20*%20%20on%20the%20output.%20If%20the%20argument%20is%20null%20or%20undefined%2C%20then%20do%0A%20*%20%20nothing.%0A%20*%20%20@param%20message%20An%20incoming%20message.%0A%20*/%0Aexports.handleResponse%20%3D%20function%20%28message%29%20%7B%0A%20%20%20%20//%20Assume%20that%20if%20the%20response%20is%20null%2C%20an%20error%20will%20be%20signaled.%0A%20%20%20%20if%20%28message%20%21%3D%3D%20null%20%26%26%20typeof%20message%20%21%3D%3D%20%27undefined%27%29%20%7B%0A%20%20%20%20%20%20%20%20//%20Handle%20redirects%20by%20creating%20a%20new%20command%20and%20making%20a%20new%0A%20%20%20%20%20%20%20%20//%20request.%20%20This%20is%20similar%20to%20issueCommand%28%29.%0A%20%20%20%20%20%20%20%20//%20The%20encodedPath%20is%20already%20in%20the%20URL%2C%20so%20we%20dont%20need%20to%20append%20it%20here.%0A%20%20%20%20%20%20%20%20if%20%28message.statusCode%20%26%26%20message.statusCode%20%3E%3D%20300%20%26%26%20message.statusCode%20%3C%3D%20308%20%26%26%20message.statusCode%20%21%3D%20306%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20body%20%3D%20this.get%28%27body%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20options%20%3D%20this.get%28%27options%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20command%20%3D%20options%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20options%20%3D%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20In%20order%20to%20be%20able%20to%20include%20the%20outputCompleteResponseOnly%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20option%2C%20we%20have%20to%20switch%20styles%20here.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20command%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20command.url%20%3D%20message.headers.location%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Don%27t%20use%20command%20%3D%20options%2C%20because%20otherwise%20if%20we%20invoke%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20this%20accessor%20multiple%20times%2C%20then%20options.url%20will%20be%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20appended%20to%20each%20time.%20%20Instead%2C%20do%20a%20deep%20clone.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20command%20%3D%20JSON.parse%28JSON.stringify%28options%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20command.url%20%3D%20message.headers.location%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20command.timeout%20%3D%20this.getParameter%28%27timeout%27%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28this.getParameter%28%27outputCompleteResponseOnly%27%29%20%3D%3D%3D%20false%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20command.outputCompleteResponseOnly%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20body%20%21%3D%3D%20%27undefined%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20command.body%20%3D%20body%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20request%20%3D%20httpClient.request%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20command%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.exports.handleResponse.bind%28this%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20request.end%28%29%3B%0A%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28message.body%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.send%28%27response%27%2C%20this.exports.filterResponse.call%28this%2C%20message.body%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.send%28%27response%27%2C%20this.exports.filterResponse.call%28this%2C%20message%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28message.statusCode%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.send%28%27status%27%2C%20message.statusCode%20+%20%27%3A%20%27%20+%20message.statusMessage%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28message.headers%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.send%28%27headers%27%2C%20message.headers%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%3B%0A%0A/**%20Register%20the%20input%20handler.%20%20*/%0Aexports.initialize%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20//%20Upon%20receiving%20a%20trigger%20input%2C%20issue%20a%20command.%0A%20%20%20%20this.addInputHandler%28%27trigger%27%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.exports.issueCommand.bind%28this%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.exports.handleResponse.bind%28this%29%29%3B%0A%7D%3B%0A%0A/**%20Upon%20wrapup%2C%20stop%20handling%20new%20inputs.%20%20*/%0Aexports.wrapup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20//%20In%20case%20there%20is%20streaming%20data%20coming%20in%2C%20stop%20it.%0A%20%20%20%20if%20%28request%29%20%7B%0A%20%20%20%20%20%20%20%20request.stop%28%29%3B%0A%20%20%20%20%20%20%20%20request%20%3D%20null%3B%0A%20%20%20%20%7D%0A%7D%3B%0A'));
    REST.setDefault('options', {"url" : "http://localhost:8096"});
    REST.setDefault('command', "");
    REST.setDefault('arguments', "");
    REST.setParameter('timeout', 5000);
    REST.setParameter('outputCompleteResponseOnly', true);

    // Start: JavaScript: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var JavaScript = this.instantiateFromCode('JavaScript', unescape('exports.setup%20%3D%20function%28%29%20%7B%0A%09this.input%28%27request%27%29%3B%0A%09this.output%28%27response%27%29%3B%0A%7D%0Aexports.initialize%20%3D%20function%28%29%20%7B%0A%09var%20self%20%3D%20this%3B%0A%09this.addInputHandler%28%27request%27%2C%20function%28%29%20%7B%0A%09%09var%20request%20%3D%20self.get%28%27request%27%29%3B%0A%09%09var%20response%20%3D%20%7B%0A%09%09%09requestID%3A%20request.requestID%2C%0A%09%09%09response%3A%20%22%3CH1%3EHello%20World%3C/H1%3E%22%0A%09%09%7D%3B%0A%09%09self.send%28%27response%27%2C%20response%29%3B%0A%09%7D%29%3B%0A%7D%0A'));

    // Start: TestSpontaneousOnce: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: TestSpontaneousOnce: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var TestSpontaneousOnce = this.instantiateFromCode('TestSpontaneousOnce', unescape('//%20Test%20accessor%20that%20spontaneously%20produces%20outputs%20once.%0A//%0A//%20Copyright%20%28c%29%202016-2017%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A%0A/**%20Test%20accessor%20that%20spontaneously%20produces%20outputs%20once%20per%20time%20interval.%0A%20*%20%20This%20implementation%20produces%20a%20counting%20sequence.%0A%20*%0A%20*%20%20@accessor%20test/TestSpontaneousOnce%0A%20*%20%20@parameter%20delay%20The%20delay%20in%20milliseconds%20before%20the%20value%20is%20outputk.%0A%20*%20%20@parameter%20value%20The%20value%20to%20be%20output%20after%20the%20delay.%0A%20*%20%20@output%20output%20The%20output%20port%0A%20*%20%20@author%20Christopher%20Brooks%20and%20Edward%20A.%20Lee.%20Based%20on%20TestSpontaneous%20by%20Edward%20A.%20Lee%0A%20*%20%20@version%20%24%24Id%3A%20TestSpontaneousOnce.js%201659%202017-05-09%2014%3A26%3A57Z%20cxh%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint.%20%20Note%20that%20there%20should%20be%20no%0A//%20space%20between%20the%20/%20and%20the%20*%20and%20global.%0A/*globals%20clearTimeout%2C%20console%2C%20error%2C%20exports%2C%20require%2C%20setTimeout%20*/%0A/*jshint%20globalstrict%3A%20true*/%0A%22use%20strict%22%3B%0A%0Aexports.setup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.parameter%28%27delay%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27number%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%201000%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27value%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27value%27%3A%20true%0A%20%20%20%20%7D%29%3B%20%0A%20%20%20%20this.output%28%27output%27%29%3B%0A%7D%3B%0A%0A//%20These%20variables%20will%20not%20be%20visible%20to%20subclasses.%0Avar%20handle%20%3D%20null%3B%0A%0Aexports.initialize%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20//%20Need%20to%20record%20%27this%27%20for%20use%20in%20the%20callback.%0A%20%20%20%20var%20thiz%20%3D%20this%3B%0A%20%20%20%20handle%20%3D%20setTimeout%28function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20thiz.send%28%27output%27%2C%20thiz.getParameter%28%27value%27%29%29%3B%0A%20%20%20%20%7D%2C%20this.getParameter%28%27delay%27%29%29%3B%0A%7D%3B%0A%0Aexports.wrapup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20if%20%28handle%29%20%7B%0A%20%20%20%20%20%20%20%20clearTimeout%28handle%29%3B%0A%20%20%20%20%20%20%20%20handle%20%3D%20null%3B%0A%20%20%20%20%7D%0A%7D%3B%0A'));
    TestSpontaneousOnce.setParameter('delay', 1000.0);
    TestSpontaneousOnce.setParameter('value', true);

    // Start: TrainableTest: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: TrainableTest: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var TrainableTest = this.instantiateFromCode('TrainableTest', unescape('//%20Copyright%20%28c%29%202016-2017%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A//%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A//%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A//%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A//%0A/**%20Compare%20the%20input%20with%20a%20known%20good%20input.%0A%20*%20%20If%20you%20set%20%27%27trainingMode%27%27%20to%20true%20and%20provide%20inputs%2C%20then%20the%0A%20*%20%20inputs%20will%20be%20recorded%20in%20the%20%27%27correctValues%27%27%20parameters.%0A%20*%20%20Otherwise%2C%20the%20inputs%20will%20be%20compared%20against%20those%20in%20the%0A%20*%20%20%27%27correctValue%27%27%20parameter.%0A%20*%0A%20*%20%20@accessor%20test/TrainableTest%0A%20*%20%20@input%20input%20The%20input%20value.%0A%20*%20%20@output%20output%20False%20as%20long%20as%20there%20is%20data%20to%20compare%20against%20the%20input%0A%20*%20%20@param%20correctValues%20a%20JSON%20array%20of%20the%20correct%20values.%0A%20*%20%20@param%20trainingMode%20true%20if%20the%20input%20is%20being%20trained.%0A%20*%20%20@author%20Christopher%20Brooks%20based%20on%20the%20Ptolemy%20NonStrictTest%20actor%20by%20Paul%20Whitaker%2C%20Christopher%20Hylands%2C%20Edward%20A.%20Lee%0A%20*%20%20@version%20%24%24Id%3A%20TrainableTest.js%202058%202017-08-16%2023%3A26%3A01Z%20cxh%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint%20and%20jshint.%20%20Note%20that%20there%20should%0A//%20be%20no%20space%20between%20the%20/%20and%20the%20*%20and%20global.%20See%0A//%20https%3A//chess.eecs.berkeley.edu/ptexternal/wiki/Main/JSHint%20*/%0A/*globals%20console%2C%20exports*/%0A/*jshint%20globalstrict%3A%20true*/%0A/*jslint%20plusplus%3A%20true%20*/%0A%27use%20strict%27%3B%0A%0Aexports.setup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.parameter%28%27correctValues%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27value%27%3A%20%5B0%5D%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.input%28%27input%27%29%3B%0A%20%20%20%20this.output%28%27output%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27boolean%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27tolerance%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27number%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%200.000000001%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27trainingMode%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27boolean%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%20false%0A%20%20%20%20%7D%29%3B%0A%7D%3B%0A%0A//%20Input%2C%20parameter%20and%20variable%20names%20match%20those%20in%20%24PTII/ptolemy/actor/lib/NonStrictTest.java%0A%0A//%20Set%20to%20true%20if%20an%20input%20is%20handled.%20%20If%20no%20inputs%20are%20handled%2C%20then%0A//%20throw%20an%20exception%20in%20wrapup%28%29.%0Avar%20inputHandled%20%3D%20false%3B%0A%0A//%20Set%20to%20true%20when%20initialize%28%29%20is%20called.%0Avar%20initialized%20%3D%20false%3B%0A%0A//%20The%20number%20of%20input%20tokens%20that%20have%20been%20read%20in.%0Avar%20numberOfInputTokensSeen%20%3D%200%3B%0A%0A//%20If%20trainingMode%20is%20true%2C%20then%20inputs%20that%20have%20been%20seen%20so%20far.%0Avar%20trainingTokens%20%3D%20%5B%5D%3B%0A%0A//%20Set%20to%20false%20in%20initialize%28%29%20and%20true%20at%20the%20end%20of%20wrapup%28%29.%0A//%20FIXME%3A%20We%20should%20have%20an%20exit%20hook%20that%20checks%20that%20wrapup%28%29%20is%20called%20for%20all%20the%20actors.%0Avar%20wrappedUp%20%3D%20false%3B%0A%0A//%20So%20we%20can%20test%20this%20in%20hosts/node/test/mocha/testMain.js%20to%20test%20that%20wrapup%20was%20called.%0Aexports.wrappedUp%20%3D%20wrappedUp%3B%0A%0A/**%20Create%20an%20input%20handler%20to%20compare%20the%20input%20with%20the%20appropriate%20element%28s%29%0A%20*%20%20from%20correctValues.%0A%20*/%0Aexports.initialize%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20//console.log%28%22Test%20initialize%28%29%3A%20typeof%20correctValues%3A%20%22%20+%20typeof%20this.getParameter%28%27correctValues%27%29%29%0A%20%20%20%20var%20inputValueValue%2C%0A%20%20%20%20%20%20%20%20self%20%3D%20this%3B%0A%0A%20%20%20%20trainingTokens%20%3D%20%5B%5D%3B%0A%20%20%20%20exports.wrappedUp%20%3D%20false%3B%0A%20%20%20%20numberOfInputTokensSeen%20%3D%200%3B%0A%0A%20%20%20%20this.addInputHandler%28%27input%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20var%20cache%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20inputValue%20%3D%20self.get%28%27input%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%3B%0A%20%20%20%20%20%20%20%20inputHandled%20%3D%20true%3B%0A%0A%20%20%20%20%20%20%20%20//%20If%20the%20input%20is%20not%20connected%2C%20then%20inputValue%20will%20be%20null.%0A%20%20%20%20%20%20%20%20if%20%28self.getParameter%28%27trainingMode%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20trainingTokens.push%28inputValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20false%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20var%20correctValuesValues%20%3D%20self.getParameter%28%27correctValues%27%29%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28numberOfInputTokensSeen%20%3C%20correctValuesValues.length%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20referenceToken%20%3D%20correctValuesValues%5BnumberOfInputTokensSeen%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20//console.log%28%22Test%3A%20%22%20+%20numberOfInputTokensSeen%20+%20%22%2C%20input%3A%20%22%20+%20inputValue%0A%20%20%20%20%20%20%20%20%20%20%20%20//+%20%22%2C%20referenceToken%3A%20%22%20+%20referenceToken%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%21%3D%3D%20%27boolean%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20%21%3D%3D%20%27number%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20%21%3D%3D%20%27object%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20%21%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValue%20%3D%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20value%20of%20the%20input%20was%20null%3F%20%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27Perhaps%20the%20input%20is%20not%20connected%3F%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue.length%20%3E%20100%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValueValue.substring%280%2C%20100%29%20+%20%27...%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20null%3B%20//%20Enable%20garbage%20collection%0A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20neither%20a%20number%20nor%20a%20string%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20+%20%27%20with%20value%20%27%20+%20inputValueValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27boolean%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20the%20input%20not%20a%20boolean%2C%20then%20throw%20an%20error.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%21%3D%3D%20%27boolean%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20not%20a%20boolean%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20+%20%27.%20%20The%20expected%20value%20was%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValue%20%21%3D%3D%20referenceToken%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%20%27%22%20is%20not%20equal%20to%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27number%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20the%20input%20not%20a%20number%2C%20then%20throw%20an%20error.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%21%3D%3D%20%27number%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20not%20a%20number%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20+%20%27.%20%20The%20expected%20value%20was%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20difference%20%3D%20Math.abs%28inputValue%20-%20referenceToken%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28isNaN%28difference%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20absolute%20value%20of%20the%20input%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValue%20+%20%27%22%20-%20the%20referenceToken%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%20is%20NaN%3F%20%20It%20should%20be%20less%20than%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.getParameter%28%27tolerance%27%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28difference%20%3E%20self.getParameter%28%27tolerance%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%20%27%22%20is%20not%20within%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.getParameter%28%27tolerance%27%29%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20of%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValue%20%21%3D%3D%20referenceToken%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20devices/test/auto/WatchEmulator.js%20needs%20this%20test%20for%20object%20because%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20we%20receive%20a%20JSON%20object%2C%20then%20we%20should%20try%20to%20stringify%20it.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch%20%28err%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%20%27%22%20is%20%21%3D%3D%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20to%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22.%20%20The%20input%20was%20an%20object%2C%20and%20a%20string%20was%20expected.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%21%3D%3D%20referenceToken%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%20%27%22%20is%20%21%3D%3D%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20to%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22.%20%20The%20input%20was%20an%20object%20and%20JSON.stringify%28%29%20did%20not%20throw%20an%20exception.%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27A%20string%20was%20expected.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20referenceTokenValue%20%3D%20JSON.stringify%28referenceToken%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20null%3B%20//%20Enable%20garbage%20collection%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20we%20are%20comparing%20longs%20from%20CapeCode%2C%20then%20the%20values%20will%20be%20like%20%221L%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20and%20stringify%20will%20return%20undefined.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%3D%3D%3D%20undefined%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28referenceTokenValue%20%3D%3D%3D%20undefined%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceTokenValue%20%3D%20referenceToken%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%21%3D%3D%20referenceTokenValue%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20inputValueValue%20could%20still%20be%20undefined%20here%20if%20inputValue%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20was%20undefined.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%21%3D%3D%20undefined%20%26%26%20inputValueValue.length%20%3E%20100%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValueValue.substring%280%2C%20100%29%20+%20%27...%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28referenceTokenValue%20%21%3D%3D%20undefined%20%26%26%20referenceTokenValue.length%20%3E%20100%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceTokenValue%20%3D%20referenceTokenValue.substring%280%2C%20100%29%20+%20%27...%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Deal%20with%20referenceTokens%20with%20value%201L.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValueValue%20%21%3D%3D%20%27object%27%20%7C%7C%20typeof%20referenceTokenValue%20%21%3D%3D%20%27object%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue.toString%28%29%20%21%3D%3D%20referenceTokenValue.toString%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20%21%3D%3D%20to%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceTokenValue%20+%20%27%22%20typeof%20inputValueValue%3A%20%27%20+%20typeof%20inputValueValue%20+%20%27%20typeof%20referenceTokenValue%3A%20%27%20+%20typeof%20referenceTokenValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20referenceToken%20%22%27%20+%20referenceToken%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20not%20a%20number%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20referenceToken%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20numberOfInputTokensSeen%20+%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20we%20are%20past%20the%20end%20of%20the%20expected%20inputs%2C%20then%20read%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28numberOfInputTokensSeen%20%3E%3D%20correctValuesValues.length%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20true%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20false%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20true%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20initialized%20%3D%20true%3B%0A%7D%3B%0A%0A/**%20If%20trainingMode%20is%20true%2C%20then%20updated%20the%20correctValues.%20*/%0Aexports.wrapup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20if%20%28this.getParameter%28%27trainingMode%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20this.setParameter%28%27correctValues%27%2C%20trainingTokens%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20if%20%28initialized%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%21inputHandled%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialized%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28this.accessorName%20+%20%27%3A%20The%20input%20handler%20of%20this%20accessor%20was%20never%20invoked.%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27Usually%2C%20this%20is%20an%20error%20indicating%20that%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27starvation%20is%20occurring.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20correctValuesValues%20%3D%20this.getParameter%28%27correctValues%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28numberOfInputTokensSeen%20%3C%20correctValuesValues.length%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28this.accessorName%20+%20%27%3A%20The%20test%20produced%20only%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20yet%20the%20correctValues%20parameter%20was%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27expecting%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20correctValuesValues.length%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20initialized%20%3D%20false%3B%0A%20%20%20%20%7D%0A%20%20%20%20var%20name%20%3D%20this.accessorName%3B%0A%0A%20%20%20%20//%20FIXME%3A%20Should%20we%20check%20to%20see%20if%20the%20name%20has%20no%20dots%20in%20and%20if%0A%20%20%20%20//%20it%20does%20not%2C%20add%20the%20container%20name%3F%0A%0A%20%20%20%20//if%20%28this.container%29%20%7B%0A%20%20%20%20//%20%20%20%20name%20%3D%20this.container.accessorName%20+%20%22.%22%20+%20name%3B%0A%20%20%20%20//%7D%0A%0A%20%20%20%20//%0A%20%20%20%20exports.wrappedUp%20%3D%20true%3B%0A%20%20%20%20//%20console.log%28%22TrainableTest.js%3A%20wrapup%28%29%20finished%3A%20%22%20+%20name%20+%20%22%2C%20exports.wrappedUp%3A%20%22%20+%20exports.wrappedUp%29%3B%0A%0A%7D%3B%0A'));
    TrainableTest.setParameter('correctValues', ["<H1>Hello World</H1>"]);
    TrainableTest.setParameter('trainingMode', false);
    TrainableTest.setParameter('tolerance', 1.0E-9);

    // Start: TrainableTest2: ptolemy/cg/adapter/generic/accessor/adapters/org/terraswarm/accessor/JSAccessor.java
    // The script has local modifications, so it is being emitted.

    // Start: TrainableTest2: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/lib/jjs/JavaScript.java
    // FIXME: See instantiate() in accessors/web/hosts/common/commonHost.js
    // We probably need to do something with the bindings.
    var TrainableTest2 = this.instantiateFromCode('TrainableTest2', unescape('//%20Copyright%20%28c%29%202016-2017%20The%20Regents%20of%20the%20University%20of%20California.%0A//%20All%20rights%20reserved.%0A//%0A//%20Permission%20is%20hereby%20granted%2C%20without%20written%20agreement%20and%20without%0A//%20license%20or%20royalty%20fees%2C%20to%20use%2C%20copy%2C%20modify%2C%20and%20distribute%20this%0A//%20software%20and%20its%20documentation%20for%20any%20purpose%2C%20provided%20that%20the%20above%0A//%20copyright%20notice%20and%20the%20following%20two%20paragraphs%20appear%20in%20all%20copies%0A//%20of%20this%20software.%0A//%0A//%20IN%20NO%20EVENT%20SHALL%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20BE%20LIABLE%20TO%20ANY%20PARTY%0A//%20FOR%20DIRECT%2C%20INDIRECT%2C%20SPECIAL%2C%20INCIDENTAL%2C%20OR%20CONSEQUENTIAL%20DAMAGES%0A//%20ARISING%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%20AND%20ITS%20DOCUMENTATION%2C%20EVEN%20IF%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20HAS%20BEEN%20ADVISED%20OF%20THE%20POSSIBILITY%20OF%0A//%20SUCH%20DAMAGE.%0A//%0A//%20THE%20UNIVERSITY%20OF%20CALIFORNIA%20SPECIFICALLY%20DISCLAIMS%20ANY%20WARRANTIES%2C%0A//%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%20IMPLIED%20WARRANTIES%20OF%0A//%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20THE%20SOFTWARE%0A//%20PROVIDED%20HEREUNDER%20IS%20ON%20AN%20%22AS%20IS%22%20BASIS%2C%20AND%20THE%20UNIVERSITY%20OF%0A//%20CALIFORNIA%20HAS%20NO%20OBLIGATION%20TO%20PROVIDE%20MAINTENANCE%2C%20SUPPORT%2C%20UPDATES%2C%0A//%20ENHANCEMENTS%2C%20OR%20MODIFICATIONS.%0A//%0A/**%20Compare%20the%20input%20with%20a%20known%20good%20input.%0A%20*%20%20If%20you%20set%20%27%27trainingMode%27%27%20to%20true%20and%20provide%20inputs%2C%20then%20the%0A%20*%20%20inputs%20will%20be%20recorded%20in%20the%20%27%27correctValues%27%27%20parameters.%0A%20*%20%20Otherwise%2C%20the%20inputs%20will%20be%20compared%20against%20those%20in%20the%0A%20*%20%20%27%27correctValue%27%27%20parameter.%0A%20*%0A%20*%20%20@accessor%20test/TrainableTest%0A%20*%20%20@input%20input%20The%20input%20value.%0A%20*%20%20@output%20output%20False%20as%20long%20as%20there%20is%20data%20to%20compare%20against%20the%20input%0A%20*%20%20@param%20correctValues%20a%20JSON%20array%20of%20the%20correct%20values.%0A%20*%20%20@param%20trainingMode%20true%20if%20the%20input%20is%20being%20trained.%0A%20*%20%20@author%20Christopher%20Brooks%20based%20on%20the%20Ptolemy%20NonStrictTest%20actor%20by%20Paul%20Whitaker%2C%20Christopher%20Hylands%2C%20Edward%20A.%20Lee%0A%20*%20%20@version%20%24%24Id%3A%20TrainableTest.js%202058%202017-08-16%2023%3A26%3A01Z%20cxh%20%24%24%0A%20*/%0A%0A//%20Stop%20extra%20messages%20from%20jslint%20and%20jshint.%20%20Note%20that%20there%20should%0A//%20be%20no%20space%20between%20the%20/%20and%20the%20*%20and%20global.%20See%0A//%20https%3A//chess.eecs.berkeley.edu/ptexternal/wiki/Main/JSHint%20*/%0A/*globals%20console%2C%20exports*/%0A/*jshint%20globalstrict%3A%20true*/%0A/*jslint%20plusplus%3A%20true%20*/%0A%27use%20strict%27%3B%0A%0Aexports.setup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20this.parameter%28%27correctValues%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27value%27%3A%20%5B0%5D%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.input%28%27input%27%29%3B%0A%20%20%20%20this.output%28%27output%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27boolean%27%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27tolerance%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27number%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%200.000000001%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20this.parameter%28%27trainingMode%27%2C%20%7B%0A%20%20%20%20%20%20%20%20%27type%27%3A%20%27boolean%27%2C%0A%20%20%20%20%20%20%20%20%27value%27%3A%20false%0A%20%20%20%20%7D%29%3B%0A%7D%3B%0A%0A//%20Input%2C%20parameter%20and%20variable%20names%20match%20those%20in%20%24PTII/ptolemy/actor/lib/NonStrictTest.java%0A%0A//%20Set%20to%20true%20if%20an%20input%20is%20handled.%20%20If%20no%20inputs%20are%20handled%2C%20then%0A//%20throw%20an%20exception%20in%20wrapup%28%29.%0Avar%20inputHandled%20%3D%20false%3B%0A%0A//%20Set%20to%20true%20when%20initialize%28%29%20is%20called.%0Avar%20initialized%20%3D%20false%3B%0A%0A//%20The%20number%20of%20input%20tokens%20that%20have%20been%20read%20in.%0Avar%20numberOfInputTokensSeen%20%3D%200%3B%0A%0A//%20If%20trainingMode%20is%20true%2C%20then%20inputs%20that%20have%20been%20seen%20so%20far.%0Avar%20trainingTokens%20%3D%20%5B%5D%3B%0A%0A//%20Set%20to%20false%20in%20initialize%28%29%20and%20true%20at%20the%20end%20of%20wrapup%28%29.%0A//%20FIXME%3A%20We%20should%20have%20an%20exit%20hook%20that%20checks%20that%20wrapup%28%29%20is%20called%20for%20all%20the%20actors.%0Avar%20wrappedUp%20%3D%20false%3B%0A%0A//%20So%20we%20can%20test%20this%20in%20hosts/node/test/mocha/testMain.js%20to%20test%20that%20wrapup%20was%20called.%0Aexports.wrappedUp%20%3D%20wrappedUp%3B%0A%0A/**%20Create%20an%20input%20handler%20to%20compare%20the%20input%20with%20the%20appropriate%20element%28s%29%0A%20*%20%20from%20correctValues.%0A%20*/%0Aexports.initialize%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20//console.log%28%22Test%20initialize%28%29%3A%20typeof%20correctValues%3A%20%22%20+%20typeof%20this.getParameter%28%27correctValues%27%29%29%0A%20%20%20%20var%20inputValueValue%2C%0A%20%20%20%20%20%20%20%20self%20%3D%20this%3B%0A%0A%20%20%20%20trainingTokens%20%3D%20%5B%5D%3B%0A%20%20%20%20exports.wrappedUp%20%3D%20false%3B%0A%20%20%20%20numberOfInputTokensSeen%20%3D%200%3B%0A%0A%20%20%20%20this.addInputHandler%28%27input%27%2C%20function%20%28%29%20%7B%0A%20%20%20%20%20%20%20%20var%20cache%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20inputValue%20%3D%20self.get%28%27input%27%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%3B%0A%20%20%20%20%20%20%20%20inputHandled%20%3D%20true%3B%0A%0A%20%20%20%20%20%20%20%20//%20If%20the%20input%20is%20not%20connected%2C%20then%20inputValue%20will%20be%20null.%0A%20%20%20%20%20%20%20%20if%20%28self.getParameter%28%27trainingMode%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20trainingTokens.push%28inputValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20false%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20var%20correctValuesValues%20%3D%20self.getParameter%28%27correctValues%27%29%3B%0A%0A%20%20%20%20%20%20%20%20if%20%28numberOfInputTokensSeen%20%3C%20correctValuesValues.length%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20referenceToken%20%3D%20correctValuesValues%5BnumberOfInputTokensSeen%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20//console.log%28%22Test%3A%20%22%20+%20numberOfInputTokensSeen%20+%20%22%2C%20input%3A%20%22%20+%20inputValue%0A%20%20%20%20%20%20%20%20%20%20%20%20//+%20%22%2C%20referenceToken%3A%20%22%20+%20referenceToken%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%21%3D%3D%20%27boolean%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20%21%3D%3D%20%27number%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20%21%3D%3D%20%27object%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20%21%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValue%20%3D%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20value%20of%20the%20input%20was%20null%3F%20%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27Perhaps%20the%20input%20is%20not%20connected%3F%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue.length%20%3E%20100%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValueValue.substring%280%2C%20100%29%20+%20%27...%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20null%3B%20//%20Enable%20garbage%20collection%0A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20neither%20a%20number%20nor%20a%20string%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20+%20%27%20with%20value%20%27%20+%20inputValueValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27boolean%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20the%20input%20not%20a%20boolean%2C%20then%20throw%20an%20error.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%21%3D%3D%20%27boolean%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20not%20a%20boolean%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20+%20%27.%20%20The%20expected%20value%20was%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValue%20%21%3D%3D%20referenceToken%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%20%27%22%20is%20not%20equal%20to%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27number%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20the%20input%20not%20a%20number%2C%20then%20throw%20an%20error.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%21%3D%3D%20%27number%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20not%20a%20number%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20inputValue%20+%20%27.%20%20The%20expected%20value%20was%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20difference%20%3D%20Math.abs%28inputValue%20-%20referenceToken%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28isNaN%28difference%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20absolute%20value%20of%20the%20input%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValue%20+%20%27%22%20-%20the%20referenceToken%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%20is%20NaN%3F%20%20It%20should%20be%20less%20than%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.getParameter%28%27tolerance%27%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28difference%20%3E%20self.getParameter%28%27tolerance%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%20%27%22%20is%20not%20within%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.getParameter%28%27tolerance%27%29%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20of%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27string%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValue%20%21%3D%3D%20referenceToken%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20devices/test/auto/WatchEmulator.js%20needs%20this%20test%20for%20object%20because%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20we%20receive%20a%20JSON%20object%2C%20then%20we%20should%20try%20to%20stringify%20it.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValue%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch%20%28err%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValue%20+%20%27%22%20is%20%21%3D%3D%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20to%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%20%27%22.%20%20The%20input%20was%20an%20object%2C%20and%20a%20string%20was%20expected.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%21%3D%3D%20referenceToken%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%20%27%22%20is%20%21%3D%3D%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20to%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceToken%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22.%20%20The%20input%20was%20an%20object%20and%20JSON.stringify%28%29%20did%20not%20throw%20an%20exception.%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27A%20string%20was%20expected.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20%28typeof%20referenceToken%20%3D%3D%3D%20%27object%27%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20JSON.stringify%28inputValue%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20referenceTokenValue%20%3D%20JSON.stringify%28referenceToken%2C%20function%20%28key%2C%20value%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20value%20%3D%3D%3D%20%27object%27%20%26%26%20value%20%21%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28cache.indexOf%28value%29%20%21%3D%3D%20-1%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Circular%20reference%20found%2C%20discard%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Store%20value%20in%20our%20collection%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache.push%28value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20null%3B%20//%20Enable%20garbage%20collection%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20we%20are%20comparing%20longs%20from%20CapeCode%2C%20then%20the%20values%20will%20be%20like%20%221L%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20and%20stringify%20will%20return%20undefined.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%3D%3D%3D%20undefined%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28referenceTokenValue%20%3D%3D%3D%20undefined%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceTokenValue%20%3D%20referenceToken%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%21%3D%3D%20referenceTokenValue%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20inputValueValue%20could%20still%20be%20undefined%20here%20if%20inputValue%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20was%20undefined.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28inputValueValue%20%21%3D%3D%20undefined%20%26%26%20inputValueValue.length%20%3E%20100%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue%20%3D%20inputValueValue.substring%280%2C%20100%29%20+%20%27...%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28referenceTokenValue%20%21%3D%3D%20undefined%20%26%26%20referenceTokenValue.length%20%3E%20100%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceTokenValue%20%3D%20referenceTokenValue.substring%280%2C%20100%29%20+%20%27...%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20Deal%20with%20referenceTokens%20with%20value%201L.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28typeof%20inputValueValue%20%21%3D%3D%20%27object%27%20%7C%7C%20typeof%20referenceTokenValue%20%21%3D%3D%20%27object%27%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputValueValue.toString%28%29%20%21%3D%3D%20referenceTokenValue.toString%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27tokens%2C%20the%20input%20%22%27%20+%20inputValueValue%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20%21%3D%3D%20to%20the%20expected%20value%20%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20referenceTokenValue%20+%20%27%22%20typeof%20inputValueValue%3A%20%27%20+%20typeof%20inputValueValue%20+%20%27%20typeof%20referenceTokenValue%3A%20%27%20+%20typeof%20referenceTokenValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28self.accessorName%20+%20%27%3A%20After%20seeing%20%27%20+%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20the%20referenceToken%20%22%27%20+%20referenceToken%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%22%20is%20not%20a%20number%2C%20it%20is%20a%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20referenceToken%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20numberOfInputTokensSeen%20+%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20we%20are%20past%20the%20end%20of%20the%20expected%20inputs%2C%20then%20read%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28numberOfInputTokensSeen%20%3E%3D%20correctValuesValues.length%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20true%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20false%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.send%28%27output%27%2C%20true%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20initialized%20%3D%20true%3B%0A%7D%3B%0A%0A/**%20If%20trainingMode%20is%20true%2C%20then%20updated%20the%20correctValues.%20*/%0Aexports.wrapup%20%3D%20function%20%28%29%20%7B%0A%20%20%20%20if%20%28this.getParameter%28%27trainingMode%27%29%29%20%7B%0A%20%20%20%20%20%20%20%20this.setParameter%28%27correctValues%27%2C%20trainingTokens%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20if%20%28initialized%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%21inputHandled%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initialized%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28this.accessorName%20+%20%27%3A%20The%20input%20handler%20of%20this%20accessor%20was%20never%20invoked.%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27Usually%2C%20this%20is%20an%20error%20indicating%20that%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27starvation%20is%20occurring.%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20correctValuesValues%20%3D%20this.getParameter%28%27correctValues%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28numberOfInputTokensSeen%20%3C%20correctValuesValues.length%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error%28this.accessorName%20+%20%27%3A%20The%20test%20produced%20only%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20numberOfInputTokensSeen%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%2C%20yet%20the%20correctValues%20parameter%20was%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27expecting%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20correctValuesValues.length%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20tokens%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20initialized%20%3D%20false%3B%0A%20%20%20%20%7D%0A%20%20%20%20var%20name%20%3D%20this.accessorName%3B%0A%0A%20%20%20%20//%20FIXME%3A%20Should%20we%20check%20to%20see%20if%20the%20name%20has%20no%20dots%20in%20and%20if%0A%20%20%20%20//%20it%20does%20not%2C%20add%20the%20container%20name%3F%0A%0A%20%20%20%20//if%20%28this.container%29%20%7B%0A%20%20%20%20//%20%20%20%20name%20%3D%20this.container.accessorName%20+%20%22.%22%20+%20name%3B%0A%20%20%20%20//%7D%0A%0A%20%20%20%20//%0A%20%20%20%20exports.wrappedUp%20%3D%20true%3B%0A%20%20%20%20//%20console.log%28%22TrainableTest.js%3A%20wrapup%28%29%20finished%3A%20%22%20+%20name%20+%20%22%2C%20exports.wrappedUp%3A%20%22%20+%20exports.wrappedUp%29%3B%0A%0A%7D%3B%0A'));
    TrainableTest2.setParameter('correctValues', [{"body":null,"method":"GET","path":"/","requestID":1}]);
    TrainableTest2.setParameter('trainingMode', false);
    TrainableTest2.setParameter('tolerance', 1.0E-9);

    // Connections: WebServerBasic: ptolemy/cg/adapter/generic/accessor/adapters/ptolemy/actor/TypedCompositeActor.java
    this.connect(JavaScript, 'response', WebServer, 'response');
    this.connect(TestSpontaneousOnce, 'output', REST, 'trigger');
    this.connect(WebServer, 'request', JavaScript, 'request');
    this.connect(REST, 'response', TrainableTest, 'input');
    this.connect(WebServer, 'request', TrainableTest2, 'input');
};

// To update the initialize code below, modify
//   $PTII/ptolemy/cg/kernel/generic/accessor/AccessorCodeGenerator.java
if (exports.initialize) {
    var originalInitialize = exports.initialize;
    exports.initialize = function() {
        originalInitialize.call(this);
        this.stopAt(15000.0);
    }
} else {
    exports.initialize = function() {
        this.stopAt(15000.0);
    }
}
