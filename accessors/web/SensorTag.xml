<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="renderHTML.xsl"?>
<!DOCTYPE class PUBLIC "-//TerraSwarm//DTD Accessor 1//EN"
    "http://www.terraswarm.org/accessors/Accessor_1.dtd">
<class name="SensorTag" extends="org.terraswarm.JSAccessor">
  <version>0.1</version>
  <author>Edward A. Lee</author>
  <input
    name="store"
    value="http://ptango.eecs.berkeley.edu:8077/keyvalue"
    type="string"/>
  <input
    name="id"
    type="number"
    value="0"/>
  <output
    name="value"
    type="string"/>    
  <documentation type="text/html">
    <![CDATA[
This accessor reads data from a key-value store location, looking for all keys at that
location that start with "sensortag". If the <i>id</i> is <i>n</i>, then
it scrolls through the list to find the (<i>n</i>+1)-th such key.
It then outputs whatever is stored associated with that key.
<p>
The server side is responsible for getting data from a SensorTag into the key-value store.
	]]>
  </documentation>
  <script type="text/javascript">
    // <![CDATA[
    var storeLocation = get(store);
    var url;
    var list = JSON.parse(readURL(storeLocation + "/list"));
    var id = get(id);
    var count = 0;
    for (var i = 0; i < list.length; i++) {
      if (list[i].match('^sensortag')) {
      	if (id <= count) {
      	  url = storeLocation + '/get?id=' + list[i];
      	  break;
      	}
      	count++;
      }
    }
	function fire() {
	  var reading = readURL(url);
	  send(reading, value);
	}
	// ]]>
  </script>
</class>
