<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Test Page for Browser Swarmlet Host</title>
    <script src="/hosts/browser/local.js"></script>
<script>
<!-- Note that the following will not work in IE 8 or older. -->
window.addEventListener('DOMContentLoaded', function() {
    // Read the code for TestAccessor.js from the server.
    var accessorPath = '/hosts/common/test/TestAccessor';
    var code = getJavaScript(accessorPath);
    
    function reportError(error) {
       alert('Error interpreting specification at '
               + accessorPath
               + ': '
               + error);
    };

    require('/hosts/common/accessor.js', function(error, a) {
        if (error) {
            alert('Failed to load accessor.js: ' + error);
        } else {
            try {
                accessor = a.accessor(code, require, getAccessor);
            } catch(error) {
                reportError(error);
                return;
            }
        }        
        require('/hosts/browser/generate.js', function(error, g) {
            if (error) {
                alert('Failed to load generate.js: ' + error);
            } else {
                try {
                    g.generate(accessor);
                    if ((typeof accessor.exports.initialize) === 'function') {
                        accessor.exports.initialize();
                    }
                } catch (error) {
                    reportError(error);
                    return;
                }
            }
        });
    });
});
</script>
</head>
<body>
<h1>Test Page for Browser Swarmlet Host</h1>
<p id="accessor"></p>
</body>
</html>